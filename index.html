<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>ReachPoint</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="./favicon.ico" />
    <link rel="stylesheet" href="./styles.css" />

    <!-- Supabase JS v2 -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
      // ===== DEV ONLY: Inject your ReachPoint-dev credentials =====
      // NOTE: Use env vars / server proxy for prod builds.
      window.__SUPABASE_URL__ = "https://qmhxpugetaksrktyfmji.supabase.co";  // <-- replace with real URL
      window.__SUPABASE_ANON_KEY__ = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFtaHhwdWdldGFrc3JrdHlmbWppIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg3NjA0NzYsImV4cCI6MjA3NDMzNjQ3Nn0.-pS4lHZKwxiVh3XL191_IMcZ-JvESva3zo2elTfSDGg";                      // <-- replace with anon key

      // Create a single shared Supabase client for the whole app.
      // IMPORTANT: Do NOT short-circuit with "window.supabase ||".
      (function initSupabase() {
        try {
          const url = window.__SUPABASE_URL__;
          const key = window.__SUPABASE_ANON_KEY__;
          if (!url || !key) {
            console.warn("[ReachPoint] Supabase credentials missing; running in local-only fallback.");
            return;
          }

          // Namespace "supabase" is provided by the CDN; we must create a client instance.
          const client = supabase.createClient(url, key, {
            auth: { persistSession: false },
            global: { headers: { "x-reachpoint-env": "dev" } },
          });

          // Expose client and a capability check
          window.supabase = client;
          window.hasSupabase = () => !!(window.supabase && typeof window.supabase.from === "function");

          console.log("[ReachPoint] Supabase client initialized:", window.hasSupabase());
        } catch (e) {
          console.error("[ReachPoint] Failed to init Supabase; local-only fallback.", e);
        }
      })();
    </script>
  </head>

  <body>
    <header class="topbar">
      <div class="brand">ReachPoint</div>
      <nav class="nav">
        <a href="#/dashboard">Dashboard</a>
        <a href="#/create">New Campaign</a>
        <a href="#/call">Call Anyone</a>
        <a href="#/insights">Insights</a>
      </nav>
    </header>

    <!-- App root -->
    <main id="app"></main>

    <!-- Default route BEFORE app loads -->
    <script>
      if (!location.hash || !/^#\//.test(location.hash)) {
        location.hash = "#/dashboard";
      }
    </script>

    <!-- Your app bundle -->
    <script type="module" src="./app.js"></script>
  </body>
</html>